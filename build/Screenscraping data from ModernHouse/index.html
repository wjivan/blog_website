<!doctype html>
<html>

<head>
  <title>Wen Jian</title>
    
  <!-- Meta -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Wen Jian">
  <meta name="author" content="Wen Jian">    
  <link rel="shortcut icon" href="favicon.ico"> 
  
  <!-- FontAwesome JS-->
  <script defer src="/static/fontawesome/js/all.min.js"></script>
  
  <!-- Theme CSS -->  
  <link id="theme-style" rel="stylesheet" href="/static/css/theme-2.css">
  <link rel="stylesheet" type="text/css" href="/static/css/custom.css">
  <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-light.min.css">
</head>

<body>
    <header class="header text-center">	    
	    <h1 class="blog-name pt-lg-4 mb-0"><a class="no-text-decoration" href="/">Wen Jian</a></h1>
        
	    <nav class="navbar navbar-expand-lg navbar-dark" >
           
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div id="navigation" class="collapse navbar-collapse flex-column" >
				<div class="profile-section pt-3 pt-lg-0">
				    <img class="profile-image mb-3 rounded-circle mx-auto" src="/static/images/profile.png" alt="image" >			
					
					<div class="bio mb-3">Economist who enjoys using data for social good<br></div><!--//bio-->
					<ul class="social-list list-inline py-3 mx-auto">
			            <li class="list-inline-item"><a href="https://twitter.com/adwenturous"><i class="fab fa-twitter fa-fw"></i></a></li>
			            <li class="list-inline-item"><a href="https://www.linkedin.com/in/wen-jian-48926b32/"><i class="fab fa-linkedin-in fa-fw"></i></a></li>
			            <li class="list-inline-item"><a href="https://github.com/wjivan"><i class="fab fa-github-alt fa-fw"></i></a></li>
			        </ul><!--//social-list-->
			        <hr> 
				</div><!--//profile-section-->
				
          <ul class="navbar-nav flex-column text-start">
            <li class="nav-item">
              <a class="nav-link" href="/"><i class="fas fa-user fa-fw me-2"></i>About Me</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="/projects/"><i class="fas fa-laptop fa-fw me-2"></i>Projects</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="/blogs/"><i class="fas fa-book fa-fw me-2"></i>Blog</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="mailto:wen.jian@cantab.net"><i class="fas fa-paper-plane fa-fw me-2"></i>Get in touch</a>
            </li>
          </ul>
			  </div>
		</nav>
  </header>
    
    <div class="main-wrapper">
	    
	    <section class="cta-section theme-bg-light py-3">
		    <div class="container text-center single-col-max-width">
			    <h2 class="heading">Economics and data science blog 
            <a href="/blogs/" class="text-decoration-none">üè†</a>
          </h2>
          <!-- Note that tags is defined in app.py as a global-->
		    </div><!--//container-->
	    </section>

      
      <div class="container">
        <div class="row px-5 d-flex justify-content-center">
          <div class="col-8 shadow-sm p-3 mb-5 bg-white rounded text-center">
              <p class="heading-minor"><b>Topics I write about:</b></p>
              
              <a href="/tag/Web%20scraping/" class="btn btn-primary btn-xs" role="button" aria-pressed="true">Web scraping</a>
              
              <a href="/tag/Gender%20inequality/" class="btn btn-primary btn-xs" role="button" aria-pressed="true">Gender inequality</a>
              

              
                <a href="/tag/Python/" class="btn btn-secondary btn-xs" role="button" aria-pressed="true">Python</a>
                
        
          </div>
        </div>
      </div>
      

      <!--Main section that other pages would extend goes here-->
      <div class="container">
      <br>
        
<div class="mb-5">
    <h4>Screenscraping real estate data from The Modern House website</h4>
    <!-- <div class="meta"><span class="date">2020-01-15</span></div> -->

    
    <div class="block">
        <b><a href="/tag/Web%20scraping/" class="text-decoration-none">Web scraping</a></b>
    </div>
    <!--  |   -->
    
    <div class="block">
        <b><a href="/tag/Python/" class="text-decoration-none">Python</a></b>
    </div>
    <!--   -->
    
</div>

    <div class="blog-post-body pb-5">
        <h5>The Modern House</h5>
<p><a href="https://www.themodernhouse.com">The Modern House</a> is a niche real estate agent that lists only architecturally unique homes for sale. The listings are tastefully presented with professional photos and introduction into the architecture history of the building.</p>
<h5>Webscraping The Modern House website using Selenium &amp; Beautiful Soup</h5>
<p>The Modern House website has a listing of all their houses on sale now. The problem with scraping through html is that the website is dynamic. You have to scroll down to reveal all the listings.</p>
<p><img src="/static/pictures/modernhousescroll/modernhousescroll.gif" class="img-fluid"></p>
<p>This is where I would use Selenium to automate this process of scrolling. </p>
<pre><code class="py"> 
    # Webscraping tools
    from urllib.request import urlopen
    from bs4 import BeautifulSoup
    from selenium import webdriver

    # Utilities
    import os

    # Data analysis
    import pandas as pd
    import numpy as np

    # Webscraping url - The Modern House

    ## Build a function to scroll down the pages to the end and extract page source using Chrome 
    def scrollExtractChrome(url):

        # Using the chrome driver
        chrome_path = os.getcwd() + '/chromedriver'
        browser = webdriver.Chrome(chrome_path)

        # Tell Selenium to get the URL you're interested in.
        browser.get(url)

        # Selenium script to scroll to the bottom, wait 3 seconds for the next batch of data to load, then continue scrolling. It will continue to do this until the page stops loading new data.
        lenOfPage = browser.execute_script("window.scrollTo(0, document.body.scrollHeight);var lenOfPage=document.body.scrollHeight;return lenOfPage;")
        match=False
        while(match==False):
            lastCount = lenOfPage
            time.sleep(3)
            lenOfPage = browser.execute_script("window.scrollTo(0, document.body.scrollHeight);var lenOfPage=document.body.scrollHeight;return lenOfPage;")
            if lastCount==lenOfPage:
                match=True

        # Now that the page is fully scrolled, grab the source code.
        return browser.page_source


    ## Define a function to extract data from the page source using a specific regex pattern
    def extractFromXML(page,tag,tag_class,pattern):
        #Create BeautifulSoup object
        soup = BeautifulSoup(page,'lxml')

        #Filter all the entries
        rows= soup.find_all(tag,attrs={'class':tag_class})

        #Use the regex pattern to extract data needed
        attributes=[re.findall(pattern, i.prettify()) for i in rows]

        #Flatten out row list for easy import into pandas
        return [item for sublist in attributes for item in sublist]

    # Define parameters for the functions made above
    url = "https://www.themodernhouse.com/sales-list/homes/all/"
    pattern_location = "<h3 class=\"listing-name\">\\n\s+(?P<name>.*)\\n\s+<br/>\\n\s+(?P<postcode>.*)\\n</h3>\\n"
    pattern_price = "<div class=\"listing-price\">\\n\s+(?P<price>¬£.*)\\n\s+<br/>\\n\s+(?P<hold>.*)\\n</div>"

    # Compile all the information downloaded into a dataframe
    df = pd.DataFrame()
    for i in range(1,6):
        link = url + str(i)
        #Extract data using the defined functions:
        page = scrollExtractChrome(link)
        location_extract = extractFromXML(page,'h3', 'listing-name', pattern_location)
        price_extract = extractFromXML(page,'div', 'listing-price', pattern_price)

        #Join two datasets together and import to pandas
        data = [a+b for a,b in zip(location_extract,price_extract)]
        labels = ['address','postcode','price','hold']
        df_part = pd.DataFrame.from_records(data, columns=labels)
        df_part['bedrooms'] = i
        df = df.append(df_part)

    df = df.reset_index(drop=True)
    df.head(20)

</code></pre>

<p>The first step is to define a scrolling function <code>scrollExtractChrome</code>  where it uses a chrome driver (to download) in your folder to execute some javascript. The script I used here is basically asking the browser to scroll down to reveal a new page until the page count doesn't increase anymore. </p>
<p>Once the scrolling is complete, the next step is to define a function <code>extractFromXML</code> to extract the data we need from the html code underneath the website. I used some Beautiful Soup functions to help me get to the right tags underlying. To find the right tags, you can right click Inspect and point to the element in the page to get the location of the html tags in the page. </p>
<p><img src="/static/pictures/modernhousescroll/modernhousehtml.gif" class="img-fluid"></p>
<p>Finally, after collecting all the data in a list, I append them together into a Pandas Dataframe like the one shown below. </p>
<p><img src="/static/pictures/modernhousescroll/Pasted image 20220111103231.png" class="img-fluid"></p>
<p>Personally, I was interested in whether Modern House was able to achieve a premium over other real estate agencies. I did an analysis using data from Zoopla to compare prices achieved on Modern House versus prices achieved on Zoopla for neighbouring flats. You can read about it on my <a href="https://github.com/wjivan/modernhousescraper">github</a>. </p>
    </div>


      </div>
      
    </div><!--//main-wrapper-->

    <nav class="navfoot py-1">
      <div style="text-align:center;">
        &copy; 2021 |
        &thinsp; <a href="https://www.linkedin.com/in/wen-jian-48926b32/"><i class="fab fa-linkedin fa-lg"></i></a>
        &thinsp; <a href="https://github.com/wjivan"><i class="fab fa-github fa-lg"></i></a> |
      </div>
    </nav>

    <!-- Javascript -->          
    <script src="/static/plugins/popper.min.js"></script> 
    <script src="/static/plugins/bootstrap/js/bootstrap.min.js"></script> 
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

</body>

</html>